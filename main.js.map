{"version":3,"sources":["webpack://squarefall/./src/constants.js","webpack://squarefall/./src/grid/grid.js","webpack://squarefall/./src/score/score.js","webpack://squarefall/./src/game/game.js","webpack://squarefall/./src/point/point.js","webpack://squarefall/./src/square/square.js","webpack://squarefall/./src/shape/shape.js","webpack://squarefall/./src/bootstrap.js","webpack://squarefall/./src/speed/speed.js","webpack://squarefall/./src/shape-generator/shape-generator.js"],"names":["SQUARE_SIDE_LENGTH","Grid","canvas","context","speed","this","shapes","movingShape","undefined","thereIsRoomToMoveDown","moveDown","thereIsRoomToMoveLeft","moveLeft","thereIsRoomToMoveRight","moveRight","moveShapeDown","points","squares","map","square","point","shape","otherPoints","filter","some","otherPoint","diff","Math","round","y","diffSmallEnough","abs","calculatedValue","x","length","originalCoordinates","getCoordinatesOfSquares","rotateClockwise","allPointsFitInsideGrid","noOtherShapeIsInTheWay","restoreCoordinatesOfSquares","every","width","height","getLargestY","noOtherShapeIsInTheWayDown","getSmallestX","noOtherShapeIsInTheWayLeft","getLargestX","noOtherShapeIsInTheWayRight","amountOfPointsInRow","rowCount","fullRowCount","i","occupiedSquaresAndShapes","Map","set","size","remove","shiftDownward","rowIndex","yLimit","moveSquaresBelowYLimit","otherShape","hasCommonPointWith","hasOccupiedPoint","includes","allRows","row","Score","high","getHighScore","document","getElementById","innerText","current","highScore","localStorage","getItem","rowsCleared","value","newValue","setItem","classList","add","setTimeout","Game","shapeGenerator","grid","roundYCoordinatesToNearestTen","removeFullRows","requestScoreIncrease","requestSpeedIncrease","generatedShape","generateShape","push","end","clearRect","forEach","drawAsRectangles","drawAsSquares","isPaused","isOver","update","draw","currentAnimationFrameRequestId","window","requestAnimationFrame","gameLoop","setCanvasWidth","setCanvasHeight","hidden","style","display","score","shownValue","SCORE_PER_SPEED_INCREASE","MAX_SPEED","paused","event","key","pause","keyPressed","moveShapeLeft","rotateShape","moveShapeRight","moveShapeToBottom","keyHandler","bind","addEventListener","pauseKeyHandler","screen","availWidth","desiredHeight","availHeight","submit","showGameOverText","clearInterval","heartbeatInterval","removeEventListener","desiredShownValue","trunc","get","increaseIfNecessary","increment","cancelAnimationFrame","Point","distance","oldX","oldY","translate","offsetX","offsetY","roundXCoordinateToNearestTen","roundYCoordinateToNearestTen","roundToNearestTen","number","toFixed","Square","fillStyle","sideLength","beginPath","fillRect","otherSquare","equals","moveDownBy","transformClockwise","occupiesCoordinates","Shape","pointOfTranslation","pointOfTranslationSquare","otherSquares","largestY","calculateLargestY","smallestX","calculateSmallestX","largestX","calculateLargestX","getPointOfTranslationX","squareToRemove","Object","prototype","hasOwnProperty","call","drawPoint","clear","thisPoint","overlaps","sort","a","b","shift","pop","isBelowLimit","verticalRectangles","squareA","squareB","reduce","acc","earlierContiguousSquare","find","earlierSquare","drawingHeight","drawingWidth","rect","I","xCoordOfAppearance","super","init","O","point1","point2","point3","L","J","S","Z","T","createElement","setAttribute","append","getContext","pixelsPerFrame","parseFloat","increase","shapeTypesAsArray","values","ChosenShapeType","random"],"mappings":"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","file":"main.js","sourcesContent":["export const SQUARE_SIDE_LENGTH = 50\n","import {\n  SQUARE_SIDE_LENGTH\n} from '../constants.js'\n\nexport const emptySquareCharacter = '\\u2b1c'\nexport const fullSquareCharacter = '\\u2b1b'\n\nexport default class Grid {\n  constructor (canvas, context, speed) {\n    this.canvas = canvas\n    this.context = context\n    this.speed = speed\n    this.shapes = []\n    this.movingShape = undefined\n  }\n\n  moveShapeDown () {\n    if (this.thereIsRoomToMoveDown()) {\n      this.movingShape.moveDown()\n    }\n  }\n\n  moveShapeLeft () {\n    if (this.thereIsRoomToMoveLeft()) {\n      this.movingShape.moveLeft()\n    }\n  }\n\n  moveShapeRight () {\n    if (this.thereIsRoomToMoveRight()) {\n      this.movingShape.moveRight()\n    }\n  }\n\n  moveShapeToBottom () {\n    while (this.thereIsRoomToMoveDown()) {\n      this.moveShapeDown()\n    }\n  }\n\n  noOtherShapeIsInTheWayDown () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint => {\n              const diff = Math.round(otherPoint.y - (point.y + SQUARE_SIDE_LENGTH))\n              const diffSmallEnough = Math.abs(diff) <= this.speed.calculatedValue\n              const meets = otherPoint.x === point.x && diffSmallEnough && diff >= 0\n              return meets\n            })\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  noOtherShapeIsInTheWayLeft () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint =>\n              otherPoint.x + SQUARE_SIDE_LENGTH === point.x &&\n              Math.abs(point.y - otherPoint.y) < SQUARE_SIDE_LENGTH)\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  noOtherShapeIsInTheWayRight () {\n    const points = this.movingShape.squares.map(square => square.point)\n\n    for (const shape of this.shapes) {\n      if (shape !== this.movingShape) {\n        const otherPoints = shape.squares.map(square => square.point)\n\n        const commonPoints = points\n          .filter(point => otherPoints\n            .some(otherPoint =>\n              otherPoint.x === point.x + SQUARE_SIDE_LENGTH &&\n              Math.abs(point.y - otherPoint.y) < SQUARE_SIDE_LENGTH)\n          )\n\n        if (commonPoints.length > 0) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  rotateShape () {\n    const originalCoordinates = this.movingShape.getCoordinatesOfSquares()\n\n    this.movingShape.rotateClockwise()\n\n    if (!(this.allPointsFitInsideGrid() && this.noOtherShapeIsInTheWay(this.movingShape))) {\n      this.movingShape.restoreCoordinatesOfSquares(originalCoordinates)\n    }\n  }\n\n  allPointsFitInsideGrid () {\n    return this.movingShape.squares.map(square => square.point.x)\n      .every(x => x >= 0 && x <= this.canvas.width - SQUARE_SIDE_LENGTH) &&\n      this.movingShape.squares.map(square => square.point.y)\n        .every(y => y >= 0 && y <= this.canvas.height - SQUARE_SIDE_LENGTH)\n  }\n\n  thereIsRoomToMoveDown () {\n    const largestY = this.movingShape.getLargestY()\n    return (largestY + SQUARE_SIDE_LENGTH < this.canvas.height) && this.noOtherShapeIsInTheWayDown()\n  }\n\n  thereIsRoomToMoveLeft () {\n    return this.movingShape.getSmallestX() - SQUARE_SIDE_LENGTH >= 0 && this.noOtherShapeIsInTheWayLeft()\n  }\n\n  thereIsRoomToMoveRight () {\n    return this.movingShape.getLargestX() + SQUARE_SIDE_LENGTH < this.canvas.width && this.noOtherShapeIsInTheWayRight()\n  }\n\n  removeFullRows () {\n    const amountOfPointsInRow = this.canvas.width / SQUARE_SIDE_LENGTH\n    const rowCount = this.canvas.height / SQUARE_SIDE_LENGTH\n    let fullRowCount = 0\n\n    for (let i = 0; i < rowCount; i += 1) {\n      const occupiedSquaresAndShapes = new Map()\n      for (const shape of this.shapes) {\n        for (const square of shape.squares) {\n          if (square.point.y === i * SQUARE_SIDE_LENGTH) {\n            occupiedSquaresAndShapes.set(square, shape)\n          }\n        }\n      }\n\n      if (occupiedSquaresAndShapes.size === amountOfPointsInRow) {\n        fullRowCount += 1\n        for (const [square, shape] of occupiedSquaresAndShapes) {\n          shape.remove(square)\n        }\n        this.shiftDownward(i)\n      }\n    }\n    this.shapes = this.shapes.filter(shape => shape.squares.length > 0)\n    return fullRowCount\n  }\n\n  shiftDownward (rowIndex) {\n    //  Everything that is above this rowIndex must shift down by SIDE_LENGTH.\n    const yLimit = rowIndex * SQUARE_SIDE_LENGTH\n    for (const shape of this.shapes) {\n      shape.moveSquaresBelowYLimit(yLimit)\n    }\n  }\n\n  noOtherShapeIsInTheWay (shape) {\n    for (const otherShape of this.shapes) {\n      if (otherShape !== shape) {\n        if (otherShape.hasCommonPointWith(shape)) {\n          return false\n        }\n      }\n    }\n\n    return true\n  }\n\n  hasOccupiedPoint (x, y) {\n    const hasOccupiedPointPerShape = this.shapes.map(shape => shape.hasOccupiedPoint(x, y))\n    return hasOccupiedPointPerShape.includes(true)\n  }\n\n  print () {\n    let allRows = ''\n    for (let y = 0; y < this.canvas.height; y += SQUARE_SIDE_LENGTH) {\n      let row = ''\n      for (let x = 0; x < this.canvas.width; x += SQUARE_SIDE_LENGTH) {\n        if (this.hasOccupiedPoint(x, y)) {\n          row += fullSquareCharacter\n        } else {\n          row += emptySquareCharacter\n        }\n      }\n      if (y !== this.canvas.height - SQUARE_SIDE_LENGTH) {\n        row += '\\n'\n      }\n      allRows += row\n    }\n    return allRows\n  }\n}\n","export default class Score {\n  constructor () {\n    this.high = Score.getHighScore()\n    document.getElementById('high-score').innerText = this.high\n    this.current = 0\n  }\n\n  static getHighScore () {\n    let highScore = localStorage.getItem('tetris-high')\n    if (highScore === undefined) {\n      highScore = 0\n    }\n    return highScore\n  }\n\n  static calculateIncrease (rowsCleared) {\n    const score = (2 ** rowsCleared) + 2\n    return score\n  }\n\n  increment (value) {\n    this.current += value\n    document.getElementById('current-score').innerText = this.current\n  }\n\n  get () {\n    return this.current\n  }\n\n  set (newValue) {\n    this.current = newValue\n  }\n\n  submit () {\n    if (this.current > this.high) {\n      localStorage.setItem('tetris-high', this.current)\n      document.getElementById('high-score').innerText = this.current\n      document.getElementById('scoreContainer').classList.add('shaken')\n      setTimeout(\n        () => document.getElementById('scoreContainer').classList.remove('shaken'),\n        1000\n      )\n    }\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nimport Grid from '../grid/grid.js'\nimport Score from '../score/score.js'\n\nexport class Game {\n  constructor (canvas, context, shapeGenerator, speed) {\n    this.canvas = canvas\n    this.context = context\n    this.shapeGenerator = shapeGenerator\n    this.speed = speed\n  }\n\n  update () {\n    if (this.grid.movingShape) {\n      if (this.grid.thereIsRoomToMoveDown()) {\n        this.grid.moveShapeDown()\n      } else {\n        this.grid.movingShape.roundYCoordinatesToNearestTen()\n        this.grid.movingShape = undefined\n        const fullRowCount = this.grid.removeFullRows()\n        if (fullRowCount > 0) {\n          this.requestScoreIncrease(fullRowCount)\n          this.requestSpeedIncrease()\n        }\n      }\n    } else {\n      const generatedShape = this.shapeGenerator.generateShape()\n      if (this.grid.noOtherShapeIsInTheWay(generatedShape)) {\n        this.grid.shapes.push(generatedShape)\n        this.grid.movingShape = generatedShape\n      } else {\n        this.end()\n      }\n    }\n  }\n\n  draw () {\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\n    this.grid.shapes.forEach(shape => {\n      if (shape === this.grid.movingShape) {\n        shape.drawAsRectangles()\n      } else {\n        shape.drawAsSquares()\n      }\n    })\n  }\n\n  gameLoop () {\n    if (!this.isPaused && !this.isOver) {\n      this.update()\n      this.draw()\n      this.currentAnimationFrameRequestId = window.requestAnimationFrame(() => this.gameLoop())\n    }\n  }\n\n  init () {\n    this.setCanvasWidth()\n    this.setCanvasHeight()\n\n    window.setTimeout(() => {\n      document.getElementById('loading').hidden = true\n      document.getElementById('container').style.display = 'grid'\n    }, 200) // to allow the user some time to spot the loading text\n\n    this.grid = new Grid(this.canvas, this.context, this.speed)\n    this.score = new Score()\n    document.getElementById('current-speed').innerText = this.speed.shownValue\n    this.SCORE_PER_SPEED_INCREASE = 50\n    this.MAX_SPEED = 9\n    this.paused = (event) => {\n      if (this.grid.movingShape) {\n        switch (event.key) {\n          case 'p': this.pause(); break\n          default: break\n        }\n      }\n    }\n    this.keyPressed = (event) => {\n      if (this.grid.movingShape) {\n        switch (event.key) {\n          case 'j':\n            this.grid.moveShapeLeft()\n            break\n          case 'k':\n            this.grid.rotateShape()\n            break\n          case 'l':\n            this.grid.moveShapeRight()\n            break\n          case ' ':\n            this.grid.moveShapeToBottom()\n            break\n          default: break\n        }\n      }\n    }\n    this.keyHandler = this.keyPressed.bind(this)\n    window.addEventListener('keypress', this.keyHandler)\n    this.pauseKeyHandler = this.paused.bind(this)\n    window.addEventListener('keypress', this.pauseKeyHandler)\n\n    this.isPaused = false\n\n    this.currentAnimationFrameRequestId = window.requestAnimationFrame(() => this.gameLoop())\n  }\n\n  setCanvasWidth () {\n    const desiredWidth = 10 * SQUARE_SIDE_LENGTH\n\n    if (desiredWidth < window.screen.availWidth) {\n      this.canvas.width = desiredWidth\n    }\n  }\n\n  setCanvasHeight () {\n    let desiredHeight = window.screen.availHeight\n\n    if (desiredHeight % 100 !== 0) {\n      desiredHeight -= desiredHeight % 100\n    }\n\n    desiredHeight -= 100 // To leave room for browser/OS UI toolbars\n\n    if (desiredHeight > 20 * SQUARE_SIDE_LENGTH) {\n      desiredHeight = 20 * SQUARE_SIDE_LENGTH\n    }\n\n    this.canvas.height = desiredHeight\n  }\n\n  end () {\n    this.score.submit()\n    Game.showGameOverText()\n    window.clearInterval(this.heartbeatInterval)\n    window.removeEventListener('keypress', this.keyHandler)\n    window.removeEventListener('keypress', this.pauseKeyHandler)\n    this.isOver = true\n  }\n\n  requestSpeedIncrease () {\n    if (this.speed.shownValue < this.MAX_SPEED) {\n      const desiredShownValue = Math.trunc(this.score.get() / this.SCORE_PER_SPEED_INCREASE) + 1\n      this.speed.increaseIfNecessary(desiredShownValue)\n    }\n  }\n\n  requestScoreIncrease (rowsCleared) {\n    this.score.increment(rowsCleared)\n  }\n\n  pause () {\n    if (this.isPaused) {\n      this.isPaused = false\n      window.addEventListener('keypress', this.keyHandler)\n      this.gameLoop()\n    } else {\n      this.isPaused = true\n      window.cancelAnimationFrame(this.currentAnimationFrameRequestId)\n      window.removeEventListener('keypress', this.keyHandler)\n    }\n  }\n\n  static showGameOverText () {\n    document.getElementById('gameOverContainer').hidden = false\n  }\n}\n","import {\n  SQUARE_SIDE_LENGTH\n} from '../constants.js'\n\nexport default class Point {\n  constructor (x, y) {\n    this.x = x\n    this.y = y\n  }\n\n  moveDownBy (distance) {\n    this.y += distance\n  }\n\n  moveLeft () {\n    this.x += -SQUARE_SIDE_LENGTH\n  }\n\n  moveRight () {\n    this.x += SQUARE_SIDE_LENGTH\n  }\n\n  transformClockwise (oldX, oldY) {\n    this.translate(-oldX, -oldY)\n    this.rotateClockwise()\n    this.translate(oldX, oldY)\n  }\n\n  translate (offsetX, offsetY) {\n    this.x = this.x + offsetX\n    this.y = this.y + offsetY\n  }\n\n  rotateClockwise () {\n    const oldX = this.x\n    const oldY = this.y\n\n    /*\n    We are performing a clockwise 90 degree rotation in a 2D coordinate system.\n    https://en.wikipedia.org/wiki/Rotation_matrix\n\n    90 degrees = Math.PI / 2 radians\n    Math.sin(Math.PI / 2) = 1\n    Math.cos(Math.PI / 2) = 0\n\n    newX = oldX * 0 - oldY * 1 = -oldY\n    newY = oldX * 1 + oldY * 0 = oldX\n    */\n\n    this.x = -oldY\n    this.y = oldX\n\n    this.roundXCoordinateToNearestTen()\n    this.roundYCoordinateToNearestTen()\n  }\n\n  equals (otherPoint) {\n    return otherPoint instanceof Point &&\n      typeof otherPoint.x === 'number' &&\n      typeof otherPoint.y === 'number' &&\n      this.x === otherPoint.x &&\n      this.y === otherPoint.y\n  }\n\n  occupiesCoordinates (x, y) {\n    return this.x === x && this.y === y\n  }\n\n  roundYCoordinateToNearestTen () {\n    this.y = this.roundToNearestTen(this.y)\n  }\n\n  roundXCoordinateToNearestTen () {\n    this.x = this.roundToNearestTen(this.x)\n  }\n\n  roundToNearestTen (number) {\n    const numberDividedByTen = number / 10 // e.g. 85.1\n    const numberWhole = numberDividedByTen.toFixed() // e.g. 85\n    const numberWholeTimesTen = numberWhole * 10 // e.g. 850\n    return numberWholeTimesTen\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nexport default class Square {\n  constructor (point, fillStyle, context, speed) {\n    // The point of a Square always refers to its top left point\n    this.point = point\n    this.fillStyle = fillStyle\n    this.context = context\n    this.sideLength = SQUARE_SIDE_LENGTH\n    this.speed = speed\n  }\n\n  draw () {\n    this.context.beginPath()\n    this.context.fillStyle = this.fillStyle\n    this.context.fillRect(this.point.x, this.point.y, this.sideLength, this.sideLength)\n  }\n\n  clear () {\n    this.context.clearRect(this.point.x, this.point.y, this.sideLength, this.sideLength)\n  }\n\n  equals (otherSquare) {\n    return otherSquare !== undefined &&\n      otherSquare instanceof Square &&\n      this.sideLength === otherSquare.sideLength &&\n      this.point.equals(otherSquare.point)\n  }\n\n  overlaps (otherSquare) {\n    return otherSquare !== undefined &&\n      otherSquare instanceof Square &&\n      this.sideLength === otherSquare.sideLength &&\n      Math.abs(this.point.x - otherSquare.point.x) < SQUARE_SIDE_LENGTH &&\n      Math.abs(this.point.y - otherSquare.point.y) < SQUARE_SIDE_LENGTH\n  }\n\n  moveDownBy (distance) {\n    this.point.moveDownBy(distance)\n  }\n\n  moveLeft () {\n    this.point.moveLeft()\n  }\n\n  moveRight () {\n    this.point.moveRight()\n  }\n\n  transformClockwise (x, y) {\n    this.point.transformClockwise(x, y)\n  }\n\n  isBelowLimit (yLimit) {\n    return this.point.y < yLimit\n  }\n\n  hasOccupiedPoint (x, y) {\n    return this.point.occupiesCoordinates(x, y)\n  }\n\n  roundYCoordinateToNearestTen () {\n    this.point.roundYCoordinateToNearestTen()\n  }\n}\n","import { SQUARE_SIDE_LENGTH } from '../constants.js'\n\nimport Point from '../point/point.js'\nimport Square from '../square/square.js'\n\nexport class Shape {\n  init (fillStyle, pointOfTranslation, points, context, speed) {\n    this.pointOfTranslation = pointOfTranslation\n\n    const pointOfTranslationSquare = new Square(pointOfTranslation, fillStyle, context, speed)\n    const otherSquares = points.map(point => new Square(point, fillStyle, context, speed))\n\n    this.squares = [pointOfTranslationSquare, ...otherSquares]\n\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n\n    this.context = context\n    this.speed = speed\n  }\n\n  getPointOfTranslationX () {\n    return this.getPointOfTranslationX\n  }\n\n  remove (squareToRemove) {\n    if (Object.prototype.hasOwnProperty.call(squareToRemove, 'point') &&\n      Object.prototype.hasOwnProperty.call(squareToRemove.point, 'x') &&\n      Object.prototype.hasOwnProperty.call(squareToRemove.point, 'y')) {\n      this.squares = this.squares.filter(square => !(square.equals(squareToRemove)))\n      this.largestY = this.calculateLargestY()\n      this.smallestX = this.calculateSmallestX()\n      this.largestX = this.calculateLargestX()\n    }\n  }\n\n  drawAsSquares () {\n    this.squares.forEach(square => square.draw())\n  }\n\n  drawPoints () {\n    this.squares.forEach(square => square.drawPoint())\n  }\n\n  clear () {\n    this.squares.forEach(square => square.clear())\n  }\n\n  rotateClockwise () {\n    this.squares.forEach(square => {\n      square.transformClockwise(this.pointOfTranslation.x, this.pointOfTranslation.y)\n    })\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  hasPoint (otherPoint) {\n    const points = this.squares.map(square => new Point(square.point.x, square.point.y))\n    const thisPoint = points.filter(point => point.equals(otherPoint))\n    return thisPoint !== undefined && thisPoint.length && thisPoint.length !== 0 && thisPoint.equals(otherPoint)\n  }\n\n  hasCommonPointWith (otherShape) {\n    for (const square of this.squares) {\n      for (const otherSquare of otherShape.squares) {\n        if (square.overlaps(otherSquare)) {\n          return true\n        }\n      }\n    }\n\n    return false\n  }\n\n  moveDown () {\n    this.squares.forEach(square => square.moveDownBy(this.speed.calculatedValue))\n    this.largestY = this.calculateLargestY()\n  }\n\n  moveLeft () {\n    this.squares.forEach(square => square.moveLeft())\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  moveRight () {\n    this.squares.forEach(square => square.moveRight())\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  calculateLargestY () {\n    return this.squares\n      .map(square => square.point.y)\n      .sort((a, b) => b - a)[0]\n  }\n\n  calculateSmallestX () {\n    return this.squares\n      .map(square => square.point.x)\n      .sort()\n      .shift()\n  }\n\n  calculateLargestX () {\n    return this.squares\n      .map(square => square.point.x)\n      .sort()\n      .pop()\n  }\n\n  getLargestY () {\n    return this.largestY\n  }\n\n  getSmallestX () {\n    return this.smallestX\n  }\n\n  getLargestX () {\n    return this.largestX\n  }\n\n  moveSquaresBelowYLimit (yLimit) {\n    this.squares.forEach(square => {\n      if (square.isBelowLimit(yLimit)) {\n        square.moveDownBy(SQUARE_SIDE_LENGTH)\n      }\n    })\n  }\n\n  hasOccupiedPoint (x, y) {\n    const hasOccupiedPointPerSquare = this.squares.map(square => square.hasOccupiedPoint(x, y))\n    return hasOccupiedPointPerSquare.includes(true)\n  }\n\n  roundYCoordinatesToNearestTen () {\n    this.squares.forEach(square => {\n      square.roundYCoordinateToNearestTen()\n    })\n  }\n\n  getCoordinatesOfSquares () {\n    return this.squares.map(square => ({\n      x: square.point.x,\n      y: square.point.y\n    }))\n  }\n\n  restoreCoordinatesOfSquares (originalCoordinates) {\n    for (let i = 0; i < originalCoordinates.length; i++) {\n      this.squares[i].point.x = originalCoordinates[i].x\n      this.squares[i].point.y = originalCoordinates[i].y\n    }\n    this.largestY = this.calculateLargestY()\n    this.smallestX = this.calculateSmallestX()\n    this.largestX = this.calculateLargestX()\n  }\n\n  /**\n   * Subpixel antialiasing is always enabled when using canvas and I am using potential floating point numbers\n   * as y-coordinates of top left points of squares for drawing. This resulted in visible vertical tearing between\n   * the squares of the moving shape.\n   * This is a workaround.\n   * Contiguous vertical squares are 'stitched' together for the purpose of drawing only.\n   */\n  drawAsRectangles () {\n    const clonedSortedSquares = [...this.squares].sort((squareA, squareB) => squareA.point.y - squareB.point.y)\n    const verticalRectangles = clonedSortedSquares.reduce((acc, square) => {\n      const earlierContiguousSquare = acc.find(earlierSquare => {\n        const diff = Math.abs(earlierSquare.y + earlierSquare.drawingHeight - square.point.y)\n        return earlierSquare.x === square.point.x && diff < 1e-10\n      })\n      if (earlierContiguousSquare) {\n        earlierContiguousSquare.drawingHeight += square.sideLength\n      } else {\n        acc.push({\n          x: square.point.x,\n          y: square.point.y,\n          drawingWidth: square.sideLength,\n          drawingHeight: square.sideLength\n        })\n      }\n      return acc\n    }, [])\n    this.context.fillStyle = this.squares[0].fillStyle\n    verticalRectangles.forEach(rect => this.context.fillRect(rect.x, rect.y, rect.drawingWidth, rect.drawingHeight))\n  }\n}\n\nclass O extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const point2 = new Point(xCoordOfAppearance, 0, speed)\n    const point3 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'thistle'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  rotateClockwise () { }\n}\n\nclass T extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH, speed)\n    const point2 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n    const point3 = new Point(xCoordOfAppearance, 0, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'lightgrey'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nclass I extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const pointOfTranslation = new Point(xCoordOfAppearance, 0, speed)\n    const point1 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, 0, speed)\n    const point2 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, 0, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'yellowgreen'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nclass S extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const point2 = new Point(xCoordOfAppearance, 0, speed)\n    const point3 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'khaki'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nclass Z extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const point2 = new Point(xCoordOfAppearance, 0, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance, SQUARE_SIDE_LENGTH, speed)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'tan'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nclass L extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, 0, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const point2 = new Point(xCoordOfAppearance, 0, speed)\n    const point3 = new Point(xCoordOfAppearance - 2 * SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'lightblue'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nclass J extends Shape {\n  constructor (xCoordOfAppearance, context, speed) {\n    super()\n\n    const point1 = new Point(xCoordOfAppearance - SQUARE_SIDE_LENGTH, 0, speed)\n    const pointOfTranslation = new Point(xCoordOfAppearance, 0, speed)\n    const point2 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, 0, speed)\n    const point3 = new Point(xCoordOfAppearance + SQUARE_SIDE_LENGTH, SQUARE_SIDE_LENGTH, speed)\n\n    const otherPoints = [point1, point2, point3]\n\n    const fillStyle = 'darksalmon'\n\n    super.init(fillStyle, pointOfTranslation, otherPoints, context, speed)\n  }\n}\n\nconst shapeTypes = {\n  I,\n  O,\n  L,\n  J,\n  S,\n  Z,\n  T\n}\n\nexport default shapeTypes\n","import { SQUARE_SIDE_LENGTH } from './constants.js'\n\nimport { Game } from './game/game.js'\nimport { ShapeGenerator } from './shape-generator/shape-generator.js'\nimport Speed from './speed/speed.js'\n\nconst canvas = document.createElement('canvas')\ncanvas.setAttribute('id', 'gameCanvas')\n\nconst gameContainer = document.getElementById('gameContainer')\ngameContainer.append(canvas)\n\nconst context = canvas.getContext('2d')\nconst speed = new Speed(parseFloat((SQUARE_SIDE_LENGTH / 32).toFixed(1)))\nconst shapeGenerator = new ShapeGenerator(canvas, context, speed)\nconst game = new Game(canvas, context, shapeGenerator, speed)\n\ngame.init()\n","export default class Speed {\n  constructor (pixelsPerFrame) {\n    this.shownValue = 1\n    this.calculatedValue = pixelsPerFrame\n  }\n\n  increase () {\n    this.shownValue += 1\n    this.calculatedValue = parseFloat((this.calculatedValue + 0.1).toFixed(1))\n  }\n\n  increaseIfNecessary (desiredShownValue) {\n    if (desiredShownValue > this.shownValue) {\n      this.increase()\n      document.getElementById('speedContainer').classList.add('shaken')\n      setTimeout(\n        () => document.getElementById('speedContainer').classList.remove('shaken'),\n        1000\n      )\n      document.getElementById('current-speed').innerText = this.shownValue\n    }\n    return this.shownValue\n  }\n}\n","import shapeTypes from '../shape/shape.js'\n\nexport class ShapeGenerator {\n  constructor (canvas, context, speed) {\n    this.canvas = canvas\n    this.context = context\n    this.speed = speed\n  }\n\n  generateShape () {\n    const shapeTypesAsArray = Object.values(shapeTypes)\n    const chosenShapeIndex = Math.round(Math.random() * (shapeTypesAsArray.length - 1))\n    const ChosenShapeType = shapeTypesAsArray[chosenShapeIndex]\n    const xCoordinateOfAppearance = this.canvas.width / 2\n    const shape = new ChosenShapeType(xCoordinateOfAppearance, this.context, this.speed)\n    return shape\n  }\n}\n"],"sourceRoot":""}